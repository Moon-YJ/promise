<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Document</title>
</head>

<body>
  <script>
    function test(delay, callback) {
      setTimeout(() => callback(), delay);
    }

    // 결과: start, end, 2초뒤에 test1, test2 순서로 호출됨
    // 순서1 - start 콘솔 출력 (callstack)
    console.log('start');
    // 순서2 - test함수 호출 (callstack)
    // 순서3 - setTimeout구문 web api에 넘기고 다음코드 바로 실행 (callstack)
    // (web api가 처리하는 업무: DOM, AJAX, Timeout=setTimeout)
    // 순서7 - setTimeout 수행하고 그 안쪽의 test1 콘솔문을 callstack에 전달 (web api)
    // (이때 이미 callstack에서 콘솔 end 업무까지 등록된 상태이기 때문에 그 다음 순서로 호출 대기 -> 단일쓰레드 방식이므로)
    test(2000, () => console.log('test1'));
    // 순서4 - 두번째 test함수 호출 (callstack)
    // 순서5 - setTimeout구문 web api에 넘기고 다음코드 바로 실행 (callstack)
    // 순서8 - setTimeout 수행하고 그 안쪽의 test2 콘솔문을 callstack에 전달 (web api)
    // (이때 이미 callstack에서 콘솔 test1 업무까지 등록된 상태이기 때문에 그 다음 순서로 호출 대기)
    test(2000, () => console.log('test2'));
    // 순서6 - end 콘솔 출력
    console.log('end');


    // 원하는 결과: start, 2초뒤에 test1, 2초뒤에 test2, end
    // callback을 통한 동기화(callstack으로 하여금 다음에 수행할 업무를 원천적으로 제거)
    // ES5에서 callback을 통해 동기화하는 원리
    // 동기화시키고 싶은 코드를 모두 callback형태로 묶어 통채로 web api에게 넘김으로써
    // callstack입장에서 다음에 실행할 코드들을 원천적으로 제거 하는 방법
    //순서1 - start출력 (callstack)
    console.log('start');
    //순서2 - 첫번째 test함수 호출 (callstack)
    //순서3 - setTimeout을 web api에게 전달 (callstack)
    test(2000, () => {
      //순서4 - setTimeout호출하고 그 안쪽의 구문을 callstack에 전달 (web api)
      //순서5 - web api로 부터 setTimeout안쪽의 callback함수 전달받고 호출 (callstack)
      console.log('test1');
      //순서6 - 다시 두번째 test함수 호출하고 안쪽의 setTimeout을 다시 web api에게 전달 (callstack)      
      test(2000, () => {
        //순서7 - setTimeout을 수행하고 아래쪽의 callback으로 전달된 구문을 다시 callstack에 전달 (web api)
        //순서8 - 아래 구문을 실행하고 종료 (callstack);
        console.log('test2');
        console.log('end');
      })
    });
  </script>
</body>

</html>